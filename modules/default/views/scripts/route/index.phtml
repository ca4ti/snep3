<?php
/**
 *  This file is part of SNEP.
 *
 *  SNEP is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  SNEP is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with SNEP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * Index View for class NewRotues
 * 
 * @category  Snep
 * @package   Snep
 * @copyright Copyright (c) 2015 OpenS Tecnologia
 * @author    Opens Tecnologia <desenvolvimento@opens.com.br>
 */

$this->headLink()->appendStylesheet( $this->baseUrl() . "/css/footable/footable.core.css" );
$this->headLink()->appendStylesheet( $this->baseUrl() . "/css/footable/footable-demos.css" );
$this->headLink()->appendStylesheet( $this->baseUrl() . "/css/footable/bootstrap-glyphicons.css" );
$this->headLink()->appendStylesheet( $this->baseUrl() . "/css/route.css" );
$this->headLink()->appendStylesheet( $this->baseUrl() . "/css/bootstrap-toggle.min.css" ); 

?>
<script src="/snep/includes/javascript/footable/footable.js" type="text/javascript"></script>
<script src="/snep/includes/javascript/footable/footable.sort.js" type="text/javascript"></script>
<script src="/snep/includes/javascript/footable/footable.filter.js" type="text/javascript"></script>
<script src="/snep/includes/javascript/footable/footable.paginate.js" type="text/javascript"></script>
<script src="/snep/includes/javascript/footable/bootstrap-tab.js" type="text/javascript"></script>
<script type="text/javascript" src="/snep/includes/javascript/bootstrap-toggle.min.js"></script>
<link href="/snep/css/snep.css" rel="stylesheet">
<link href="/snep/css/bootstrap-theme.min.css" rel="stylesheet">

<div class="row">
    
    <div class="snep-body-top-buttons">
            
        <a class="btn btn-outline btn-add btn-add-route" style="margin-right: 5px;" href="<?php echo $this->baseUrl ?>/simulator " role="button"><?php echo $this->translate("Simulator")?></a>
        <a class="btn btn-add" href="<?php echo $this->url ?>/add/ " role="button"><?php echo $this->translate("Add Rule")?></a>
        
        <?php if ($this->hide_routes === "1") {?>
                
            <span class=" btn hide_rules_enable">
                <span class="sn-visivel fa-fw" style="font-size: 14px;"></span>
                <?php echo $this->translate("Hide routes is enable")?>
                </span>

        <?php } else {?>
                    
            <span class=" btn hide_rules_disable">
            <span class="sn-oculto fa-fw"></span>
            <?php echo $this->translate("Hide routes is disable")?>
            </span>
        <?php } ?>
    
        <div class="snep-body-search" >
            <?php if($this->key){ ?>
                <a class='sn-dash-add' href="<?php echo $this->baseUrl ?>/default/index/index?dashboard_add=<?php echo $this->key ?>" title="<?php echo $this->translate('Add to dashboard');?>">
                        </a> 
            <?php } ?>
        </div>
    </div>

    <?php if ($this->error_message) {
            echo $this->action( 'sneperror', 'error', null, array( 'error_type' => 'alert', 
            'error_title' => $this->translate('Alert'), 'error_message' => $this->error_message, 'error_buttons' => False) );
    } else { ?>

    <div class="col-md-12">
        
        <!-- Incoming -->
        <div class="panel-group" id="accordion">
            <div class="panel panel-default">
                <div class="panel-heading ip-status">
                    <h4>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                            <button type="button" class="boxadd add_field" id="exten" style="background-color:transparent !important;">
                                <?php if(is_array($this->incoming)){
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Incoming"). "(". count($this->incoming) . ")";
                                }else{
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Incoming"). "(0)";
                                }?>
                            </button>

                        </a>
                    </h4>
                </div>

                <div id="collapseOne" class="panel-collapse collapse ip-status" style="background-color: #fff !important">
                <div class="panel-body">
                <div class="table-responsive">

                <?php
                if(is_array($this->incoming)){ ?>

                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th style="width: 5%;" class="text-center" data-type="numeric"  ><?php echo $this->translate('Id');?></th>
                            <th style="width: 6%; " class="text-center" data-type="numeric" data-sort-initial="false"><?php echo $this->translate('Prio');?></th>                        
                            <th><?php echo $this->translate('Source');?></th>
                            <th><?php echo $this->translate('Destiny');?></th>
                            <th><?php echo $this->translate('Description');?></th>
                            <th colspan="4" class="text-center" style="width: 20%;" data-sort-ignore="true"><?php echo $this->translate('Actions');?></th>
                        </tr>
                        </thead>
                     
                        <tbody>
                        <?php
                        foreach ($this->incoming as $key => $route) { ?>
                                
                            <tr>
                                <th class="text-center" style="vertical-align: middle !important; padding: 0px 8px 0px 8px;"> <?php echo $route['id'] ?>  </th>
                                <td style="padding: 0px 8px 0px 8px;" class="text-center"> <?php echo $route['prio'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['origem'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['destino'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['desc'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> 
                                    
                                    <div class="checkbox">
                                    <label><input type="checkbox" data-toggle="toggle" data-size="mini" <?php echo $route['ativa'] === '1' ? 'checked' : ''; ?> id="rule_state" value="<?php echo $route['id'];?>" onchange="change_status(this.value)" ></label>
                                    </div>
                                </td>
                                              
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-default btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/duplicate/<?php echo $route['id']?>' >
                                    <?php echo $this->translate('Duplicate')?>
                                    </a>
                                </td>
                            
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-edit btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/edit/<?php echo $route['id'] ?>'>
                                    <?php echo $this->translate('Edit')?>
                                    </a>
                                </td>

                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-danger btn-xs"  href="<?php echo $this->baseUrl ?>/route/remove/id/<?php echo $route['id'] ?>" role="button"><?php echo $this->translate('Delete')?></a>
                                </td>
                            </tr>
                        <?php } ?>
                                                                 
                        </tbody>
                    </table>
                    
                <?php }else{ 

                    echo $this->incoming;

                } ?>

                </div>
                </div>
                </div>

            </div>
            <!-- /Incoming -->

            <!-- Outgoing -->
            <div class="panel panel-default">
                <div class="panel-heading ip-status">
                    <h4>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                            <button type="button" class="boxadd add_field" id="trunk" style="background-color:transparent !important;">
                                <?php if(is_array($this->outgoing)){
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Outgoing"). "(". count($this->outgoing) . ")";
                                }else{
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Outgoing"). "(0)";
                                }?>
                            </button>
                        </a>
                    </h4>
                </div>

                <div id="collapseTwo" class="panel-collapse collapse ip-status" style="background-color: #fff !important">
                <div class="panel-body">
                <div class="table-responsive">

                <?php
                if(is_array($this->outgoing)){ ?>

                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th style="width: 5%;" class="text-center" data-type="numeric"  ><?php echo $this->translate('Id');?></th>
                            <th style="width: 6%; " class="text-center" data-type="numeric" data-sort-initial="false"><?php echo $this->translate('Prio');?></th>                        
                            <th><?php echo $this->translate('Source');?></th>
                            <th><?php echo $this->translate('Destiny');?></th>
                            <th><?php echo $this->translate('Description');?></th>
                            <th colspan="4" class="text-center" style="width: 20%;" data-sort-ignore="true"><?php echo $this->translate('Actions');?></th>
                        </tr>
                        </thead>
                     
                        <tbody>
                        <?php
                        foreach ($this->outgoing as $key => $route) { ?>
                                
                            <tr>
                                <th class="text-center" style="vertical-align: middle !important; padding: 0px 8px 0px 8px;"> <?php echo $route['id'] ?>  </th>
                                <td style="padding: 0px 8px 0px 8px;" class="text-center"> <?php echo $route['prio'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['origem'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['destino'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['desc'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> 
                                    
                                    <div class="checkbox">
                                    <label><input type="checkbox" data-toggle="toggle" data-size="mini" <?php echo $route['ativa'] === '1' ? 'checked' : ''; ?> id="rule_state" value="<?php echo $route['id'];?>" onchange="change_status(this.value)" ></label>
                                    </div>
                                </td>
                                              
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-default btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/duplicate/<?php echo $route['id']?>' >
                                    <?php echo $this->translate('Duplicate')?>
                                    </a>
                                </td>
                            
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-edit btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/edit/<?php echo $route['id'] ?>'>
                                    <?php echo $this->translate('Edit')?>
                                    </a>
                                </td>

                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-danger btn-xs"  href="<?php echo $this->baseUrl ?>/route/remove/id/<?php echo $route['id'] ?>" role="button"><?php echo $this->translate('Delete')?></a>
                                </td>
                            </tr>
                        <?php } ?>
                                                                 
                        </tbody>
                    </table>
                    
                <?php }else{ 

                    echo $this->outgoing;

                } ?>

                </div>
                </div>
                </div>

            </div>
            <!-- /Outgoing -->

            <!-- Others -->
            <div class="panel panel-default">
                <div class="panel-heading ip-status">
                    <h4>
                        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                            <button type="button" class="boxadd add_field" id="others" style="background-color:transparent !important;">
                                <?php if(is_array($this->others)){
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Others"). "(". count($this->others) . ")";
                                }else{
                                    echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$this->translate("Rules&nbsp;of&nbsp;Others"). "(0)";
                                }?>
                            </button>
                        </a>
                    </h4>
                </div>

                <div id="collapseThree" class="panel-collapse collapse ip-status" style="background-color: #fff !important">
                <div class="panel-body">
                <div class="table-responsive">

                <?php
                if(is_array($this->others)){ ?>

                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th style="width: 5%;" class="text-center" data-type="numeric"  ><?php echo $this->translate('Id');?></th>
                            <th style="width: 6%; " class="text-center" data-type="numeric" data-sort-initial="false"><?php echo $this->translate('Prio');?></th>                        
                            <th><?php echo $this->translate('Source');?></th>
                            <th><?php echo $this->translate('Destiny');?></th>
                            <th><?php echo $this->translate('Description');?></th>
                            <th colspan="4" class="text-center" style="width: 20%;" data-sort-ignore="true"><?php echo $this->translate('Actions');?></th>
                        </tr>
                        </thead>
                     
                        <tbody>
                        <?php
                        foreach ($this->others as $key => $route) { ?>
                                
                            <tr>
                                <th class="text-center" style="vertical-align: middle !important; padding: 0px 8px 0px 8px;"> <?php echo $route['id'] ?>  </th>
                                <td style="padding: 0px 8px 0px 8px;" class="text-center"> <?php echo $route['prio'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['origem'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['destino'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> <?php echo $route['desc'] ?> </td>
                                <td style="padding: 0px 8px 0px 8px;"> 
                                    
                                    <div class="checkbox">
                                    <label><input type="checkbox" data-toggle="toggle" data-size="mini" <?php echo $route['ativa'] === '1' ? 'checked' : ''; ?> id="rule_state" value="<?php echo $route['id'];?>" onchange="change_status(this.value)" ></label>
                                    </div>
                                </td>
                                              
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-default btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/duplicate/<?php echo $route['id']?>' >
                                    <?php echo $this->translate('Duplicate')?>
                                    </a>
                                </td>
                            
                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-edit btn-xs"  href='<?php echo $this->baseUrl(); ?>/index.php/route/edit/<?php echo $route['id'] ?>'>
                                    <?php echo $this->translate('Edit')?>
                                    </a>
                                </td>

                                <td style="padding: 0px 8px 0px 8px;" align="center">
                                    <a class="btn btn-danger btn-xs"  href="<?php echo $this->baseUrl ?>/route/remove/id/<?php echo $route['id'] ?>" role="button"><?php echo $this->translate('Delete')?></a>
                                </td>
                            </tr>
                        <?php } ?>
                                                                 
                        </tbody>
                    </table>
                    
                <?php }else{ 

                    echo $this->others;

                } ?>

                </div>
                </div>
                </div>

            </div>
            <!-- /Others -->
        </div>  
    </div>
    <?php }  ?>  
</div> <!-- /.row -->   

<script type="text/javascript">

    jQuery.noConflict();
    jQuery.noConflict();
    jQuery(function () {
        jQuery('table').footable().on('click', '.row', function(e) {
            e.preventDefault(); 
        });
    });

    /*
     * Change rule status 
     * @param id - rule id
     */
    function change_status(id) {
        jQuery.post('<?php echo $this->baseUrl(); ?>/index.php/route/toogle/', {route: id});
    }

    jQuery( document ).ready(function() {
        // Changle the icon of panel titles when clicked
        jQuery("#exten,#trunk,#others").click(function() {
            // Toggle clicked element
            if(jQuery(this).hasClass('add_field')) {
                jQuery(this).removeClass('boxadd add_field').addClass('boxremove del_field') ;
            } else { 
                jQuery(this).removeClass('boxremove del_field').addClass('boxadd add_field') ;
            }
            // Togle other elements
            var sel=jQuery(this).attr('id') ;
            var arr = [ 'exten','trunk','others'] ;
            var list = arr.splice(arr.indexOf(sel),1);
            jQuery.each(arr,function(index,value){
                var pid = jQuery('#'+value).parent().attr('href') ;
                var flag = false ;
                if (jQuery(pid).hasClass('in')) {
                    flag = true ;
                }
                if(flag) {
                    if (jQuery('#'+value).hasClass('del_field')) {
                        jQuery('#'+value).removeClass('boxremove del_field').addClass('boxadd add_field') ;
                    } else {
                        jQuery('#'+value).removeClass('boxadd add_field').addClass('boxremove del_field') ;
                    }
                } 
            });
        });
    });



</script>
